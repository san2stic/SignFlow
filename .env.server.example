# =============================================================================
# .env.server.example — Template configuration serveur GPU local
# =============================================================================
# Copier ce fichier en .env.server et remplir les valeurs réelles.
# NE PAS VERSIONNER .env.server dans git (déjà dans .gitignore).
#
# Commandes utiles :
#   openssl rand -base64 64   → générer un secret fort
#   openssl rand -hex 32      → alternative hexa
# =============================================================================

ENV=production

# ── Authentification JWT ─────────────────────────────────────────────────────
# Minimum 32 caractères, utiliser openssl rand -base64 64
JWT_SECRET_KEY=REMPLACER_avec_openssl_rand_-base64_64

# ── Base de données PostgreSQL ────────────────────────────────────────────────
POSTGRES_DB=signflow
POSTGRES_USER=signflow
POSTGRES_PASSWORD=REMPLACER_mot_de_passe_fort

# ── Redis ─────────────────────────────────────────────────────────────────────
REDIS_PASSWORD=REMPLACER_mot_de_passe_redis

# ── MinIO S3 Object Storage ───────────────────────────────────────────────────
# MINIO_ROOT_USER = login admin console MinIO (http://localhost:9001)
MINIO_ROOT_USER=signflow-admin
MINIO_ROOT_PASSWORD=REMPLACER_16_chars_minimum

# Noms des buckets (créés automatiquement par minio_setup au démarrage)
MINIO_BUCKET_VIDEOS=signflow-videos
MINIO_BUCKET_MODELS=signflow-models

# MINIO_VOLUMES est chargé séparément via : source minio-volumes.env
# Ne pas définir ici — généré par scripts/setup-storage.sh

# ── Backend S3 (doit correspondre aux valeurs MinIO ci-dessus) ───────────────
USE_S3_STORAGE=true
S3_ENDPOINT_URL=http://minio:9000
S3_ACCESS_KEY=signflow-admin
# S3_SECRET_KEY = même valeur que MINIO_ROOT_PASSWORD
S3_SECRET_KEY=REMPLACER_16_chars_minimum
S3_BUCKET_VIDEOS=signflow-videos
S3_BUCKET_MODELS=signflow-models
S3_PRESIGNED_URL_EXPIRY=3600
S3_REGION=us-east-1

# ── Cloudflare Tunnel ─────────────────────────────────────────────────────────
# Obtenir depuis : Cloudflare Zero Trust → Networks → Tunnels → [votre tunnel] → Configure
# Format : eyJhIjoiXXXXX... (JWT très long)
CLOUDFLARE_TUNNEL_TOKEN=REMPLACER_token_depuis_dashboard_cloudflare

# ── GPU NVIDIA ───────────────────────────────────────────────────────────────
TORCH_DEVICE=cuda
TS_NUMBER_OF_GPU=1

# ── Services ML ──────────────────────────────────────────────────────────────
USE_TORCHSERVE=true
TORCHSERVE_URL=http://torchserve:8080
TORCHSERVE_TIMEOUT_MS=2000

# ── Paramètres application ────────────────────────────────────────────────────
TRUSTED_HOSTS=*
ENABLE_DOCS=false
MAX_REQUEST_MB=64
MAX_UPLOAD_MB=50
MAX_VIDEO_SECONDS=10

# Rate limiting
RATE_LIMIT_PER_MINUTE=120
WRITE_RATE_LIMIT_PER_MINUTE=40
WS_MAX_CONNECTIONS_PER_IP=3
WS_MESSAGES_PER_MINUTE=900

# Celery pour les tâches d'entraînement async
TRAINING_USE_CELERY=true

# ── MLflow Tracking ───────────────────────────────────────────────────────────
MLFLOW_REGISTRY_ENABLED=true
MLFLOW_REGISTRY_MODEL_NAME=signflow-model
MLFLOW_S3_ENDPOINT_URL=http://minio:9000
# AWS_ACCESS_KEY_ID et AWS_SECRET_ACCESS_KEY sont lus par boto3 MLflow
# (définir les mêmes valeurs que MINIO_ROOT_USER/PASSWORD)

# ── Elasticsearch ─────────────────────────────────────────────────────────────
SEARCH_BACKEND=elasticsearch
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_INDEX=signflow-signs
ELASTICSEARCH_TIMEOUT_MS=2000
ELASTICSEARCH_REINDEX_ON_STARTUP=false
ELASTICSEARCH_FAIL_OPEN=true
ELASTICSEARCH_VERIFY_CERTS=false

# ── Features avancées (optionnel) ─────────────────────────────────────────────
INFERENCE_METRICS_ENABLED=true
DRIFT_DETECTION_ENABLED=true
CANARY_PERCENTAGE=0
SHADOW_MODE_ENABLED=false
ACTIVE_LEARNING_ENABLED=false
